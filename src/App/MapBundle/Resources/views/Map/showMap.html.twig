{% extends '::base.html.twig' %}

{% block body -%}
    <script src="{{ asset('https://code.angularjs.org/1.3.3/angular.min.js') }}"></script>
    <script src="{{ asset('http://code.jquery.com/jquery-1.11.1.min.js') }}"></script>
    <script src="{{ asset('/static/js/ng_map.js') }}"></script>
    <script src="{{ asset('/static/js/ng_style.js') }}"></script>
    <script src="{{ asset('/static/js/ya_map.js') }}"></script>
    <script src="{{ asset('http://api-maps.yandex.ru/2.1/?lang=ru_RU&ns=&onload=startMap') }}"></script>
    <link rel="stylesheet" href="{{ asset('static/css/main.css') }}" type="text/css" media="all">
    <link rel="stylesheet" href="{{ asset('static/css/map_edit.css') }}" type="text/css" media="all">
<div ng-app="app" ng-controller="main" ng-init="
    imw = 600; imh =400;
    sx = {{ entity.x }}; sy = {{ entity.y }};
    change(); toogleMap();
    ">
    <h3>Добавление координат</h3>
    <form method="post" action="{{ path('app_map_save', {'id': entity.id}) }}">
        <table class="record_properties">
            <tbody>
                <tr>
                    <th>Название:</th>
                    <td>{{ entity.name }}</td>
                </tr>
                <tr>
                    <th>Карта:</th>
                    <td>
                        <div id="main_el" ng-click="click($event)">
                            <div ng-repeat="coord_y in array_y track by $index"
                                 style="margin-top: {[coord_y]}px" class="display_x">
                                <div ng-bind="$index"></div>
                            </div>
                            <div ng-repeat="coord_x in array_x track by $index"
                                 style="margin-left: {[coord_x]}px" class="display_y">
                                <div ng-bind="$index"></div>
                            </div>

                            <div ng-repeat="coord in coordinates track by $index" style="margin-top:{[coord.y-5]}px;margin-left:{[coord.x-5]}px;" class="coordinate">
                                <input type="hidden" name="coordx[{[$index]}]" value="{[coord.x]}" />
                                <input type="hidden" name="coordy[{[$index]}]" value="{[coord.y]}" />
                                <input type="hidden" name="coordname[{[$index]}]" value="{[coord.name]}" />
                            </div>
                            <div id="myMap" ng-style="{[ {
                                'width': imw + 'px',
                                'height': imh + 'px'
                            } ]}"></div>
                        </div>
                        <table class="tab_coords">
                            <tr><td>Номер</td><td>Координаты</td><td>Квадрат</td></tr>
                            <tr ng-repeat="coord in coordinates track by $index">
                                <td>Точка {[$index+1]}</td>
                                <td>x: {[coord.x]}, y: {[coord.y]}</td>
                                <td>{[coord.name]}</td>
                                <td><a ng-click="delete($index)">Удалить</a></td>
                            </tr>
                        </table>
                        <br>
                        <a ng-click="toogleMap()" ng-bind="mapEditText"></a>
                    </td>
                </tr>
                <tr>
                    <th>Квадратов по X:</th>
                    <td><input ng-model="sx" name="x" type="number" /></td>
                </tr>
                <tr>
                    <th>Квадратов по Y:</th>
                    <td><input ng-model="sy" name="y" type="number" /></td>
                </tr>
            </tbody>
        </table>
        <input type="hidden" name="yandex_image" value="{[urlYaIm]}" />
        <input type="submit" class="btn btn-success" value="Сохранить"/>
        </form>
</div>

{% endblock %}
